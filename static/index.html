<!doctype html>
<title>Books Companion</title>
<base href="/" target="_blank">

<link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
>

<body>

    <header>books.paircoded.com</header>

<div id="main">

    <article></article>

    <nav></nav>

    <aside>
        <article>
            <h1>Upload Book</h1>
            <form id="book-upload-form"><input type="file"></form>
        </article>
    </aside>

</div>

<footer></footer>

<script type="module">
import Keycloak from 'https://cdn.jsdelivr.net/npm/keycloak-js@26.0.7/+esm';

const keycloak = new Keycloak({
    url: "https://accounts.paircoded.com",
    realm: "paircoded",
    clientId: "books-www-ui"
});

async function getData() {
    const url = "https://books-api.paircoded.com/items/1";
    try {
        const response = await fetch(url, {
            headers: {
                accept: 'application/json',
                authorization: `Bearer ${keycloak.token}`,
            }
        });
        if (!response.ok) {
            throw new Error(`Response status: ${response.status}`);
        }

        const json = await response.json();
        console.log(json);
    } catch (error) {
        console.error(error.message);
    }
}


try {
    const authenticated = await keycloak.init({
        onLoad: 'login-required'
    });
    if (authenticated) {
        getData();
    } else {
        console.log('User is not authenticated');
    }
} catch (error) {
    console.error('Failed to initialize adapter:', error);
}
</script>

</body>